// Nextflow configuration for AGAT performance benchmarking

// Profiles for different execution environments
profiles {
    
    // Local execution (default)
    standard {
        executor {
            name = 'local'
            memory = '20 GB'
            queueSize = 1
            maxForks = 1
        }
    }
    
    // SLURM with Singularity
    slurm_singularity {
        process {
            executor = 'slurm'
            container = 'quay.io/biocontainers/agat:1.4.0--pl5321hdfd78af_0'
            
            // SLURM configuration
            queue = 'main'
            clusterOptions = '--qos=normal'
            
            withName: 'convertRun' {
                // cpus is set dynamically from the process directive
                memory = '8.GB'
                time = '1.h'
                clusterOptions = '--qos=normal --mem-per-cpu=2G'
            }
            
            withName: 'makeSubset' {
                cpus = 1
                memory = '2.GB'
                time = '30.m'
            }
            
            withName: 'aggregate' {
                cpus = 1
                memory = '1.GB'
                time = '10.m'
            }
        }
        
        singularity {
            enabled = true
            autoMounts = true
            runOptions = '--cleanenv'
        }
        
        executor {
            queueSize = 50
            submitRateLimit = '10/1min'
        }
    }
    
    // SLURM with Docker (if your cluster supports it)
    slurm_docker {
        process {
            executor = 'slurm'
            container = 'quay.io/biocontainers/agat:1.4.0--pl5321hdfd78af_0'
            queue = 'main'
            
            withName: 'convertRun' {
                memory = '8.GB'
                time = '1.h'
                clusterOptions = '--qos=normal --mem-per-cpu=2G'
            }
        }
        
        docker {
            enabled = true
            runOptions = '-u $(id -u):$(id -g)'
        }
    }
}


// Enable execution reports
trace {
    enabled = true
    file = 't/perf_results/trace.txt'
    fields = 'task_id,hash,native_id,process,tag,status,exit,cpus,memory,duration,realtime,%cpu,%mem'
}

timeline {
    enabled = true
    file = 't/perf_results/timeline.html'
}

report {
    enabled = true
    file = 't/perf_results/report.html'
}

// Work directory
workDir = './work'

// Cleanup options
cleanup = false  // Set to true to automatically clean work directory after successful completion
